# 开发

## 开发

```shell
php artisan native:serve
```

NativePHP 不会限制您开发应用的方式。您可以按照自己最熟悉和舒适的方式来构建应用，就像您在构建传统的网页应用一样。

唯一的区别在于反馈循环。您不再需要切换到浏览器并刷新页面，而是需要使用 `php artisan native:serve` 来服务您的应用，并在某些情况下刷新（或重启）应用以查看更改。

这被称为“运行开发构建”。

### `native:serve` 命令的作用是什么？

`native:serve` 命令运行 Electron/Tauri 的“调试构建”命令，这些命令在构建应用时设置了各种调试选项，以帮助简化调试过程，例如允许您在嵌入式网页视图中显示开发者工具。

它还保持与终端的连接打开，以便您可以实时查看和检查来自应用的有用输出，如日志。

这些构建是未签名的，不适合分发。它们不会进行通常在构建生产应用时进行的各种优化，因此它们比您通常希望与用户共享的代码更多地暴露了代码的内部工作原理。

构建过程的一个重要部分，即使是对于调试构建，也涉及将您的应用代码复制到运行时的构建环境中。这意味着您对应用代码所做的更改在您重启应用之前不会反映在运行的应用中。

您可以通过在运行 `native:serve` 命令的终端窗口中按 `Ctrl-C` 来停止该命令。

或者，您可以使用热重载。

### 热重载

热重载是在开发期间自动查看应用更改的绝佳功能。NativePHP 支持其核心和您的应用中某些文件的热重载，但它不会监视所有源代码的更改。您需要自己决定如何处理这个问题。

如果您使用 Vite，只要您启动了 Vite 开发服务器，并在视图中[包含 Vite 脚本标签](https://laravel.com/docs/vite#loading-your-scripts-and-styles)（最好在应用的主布局文件中），热重载就会在您的应用中正常工作。

您可以使用 Blade 中的 `@@vite` 指令轻松实现这一点。

然后，在运行 `php artisan native:serve` 的单独终端会话中，从您的应用根目录运行：

```shell
npm run dev
```

现在，您对源代码文件所做的更改将导致在运行的应用中进行热重载。

触发重载的文件将取决于您的 Vite 配置。

### 首次运行

当您的应用首次运行时，会发生一系列事件。

NativePHP 将：

1. 创建 `appdata` 文件夹 - 其创建位置取决于您开发的平台。它根据您的 `nativephp.app_id` 配置值（基于 `NATIVEPHP_APP_ID` 环境变量）命名。
2. 创建 SQLite 数据库
3. 迁移数据库

这与新用户在他们的设备上首次运行您的应用的生产构建时发生的情况相同。

**如果您更改了 `app_id`，可能需要创建一个新的 `appdata` 文件夹，并且所有这些步骤都需要再次运行。之前的文件不会被删除。**

### 后续运行

每次您的应用启动时，NativePHP 都会检查这些文件是否存在，并在不存在时创建它们。它还会尝试运行您的迁移。这是使用 `--force` 标志完成的，因此即使在生产环境中也是完全自动化的。
